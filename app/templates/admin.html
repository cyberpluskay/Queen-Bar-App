<!DOCTYPE html>
<html lang="en">
<head>
    <script>
        // Idle timeout in milliseconds (10 minutes)
        const IDLE_TIMEOUT = 10 * 60 * 1000;
    
        let idleTimer;
    
        function resetTimer() {
            clearTimeout(idleTimer);
            idleTimer = setTimeout(() => {
                // Redirect to logout after being idle
                window.location.href = "{{ url_for('auth.logout') }}";
            }, IDLE_TIMEOUT);
        }
    
        // Reset timer on user activity
        window.onload = resetTimer;
        document.onmousemove = resetTimer;
        document.onkeypress = resetTimer;
        document.onscroll = resetTimer;
    </script>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">

</head>
<body>
    <!-- Navigation Bar with Logout Button -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Admin Panel</a>
            <div class="d-flex align-items-center">
                {% if current_user.is_authenticated %}
                    <span class="text-white me-3">Welcome, {{ current_user.username }}</span>
                {% endif %}
                <a href="{{ url_for('auth.logout') }}" class="btn btn-danger"><i class="fas fa-sign-out-alt"></i> Logout</a>
            </div>
        </div>
    </nav>

    <div class="container mt-5">
        <h1 class="text-center">Admin Panel</h1>

        <!-- Navigation Links -->
        <div class="text-center mb-4">
            <a href="{{ url_for('main.dashboard') }}" class="btn btn-primary me-2">Dashboard</a>
            <a href="{{ url_for('main.bartender') }}" class="btn btn-dark"><i class="fas fa-cocktail"></i> Bartender Panel</a>
            <a href="{{ url_for('main.sales_management') }}" class="btn btn-secondary me-2">Manage Sales</a>
            <a href="{{ url_for('main.manage_users') }}" class="btn btn-info me-2">Manage Users</a>
            <a href="{{ url_for('main.daily_sales_report') }}" class="btn btn-success me-2">Daily Sales Report</a>
            <a href="{{ url_for('main.low_stock_report') }}" class="btn btn-warning me-2">Low Stock Report</a>
            <a href="{{ url_for('main.profit_loss_report') }}" class="btn btn-danger">Profit/Loss Report</a>
            <a href="{{ url_for('main.change_password') }}" class="btn btn-outline-warning me-2">Change Password</a>
        </div>

        <!-- Low Stock Alerts -->
        {% if low_stock_drinks %}
        <div class="alert alert-warning" role="alert">
            <h4 class="alert-heading">Low Stock Alert!</h4>
            <p>The following drinks are running low on stock:</p>
            <ul>
                {% for drink in low_stock_drinks %}
                <li>{{ drink.name }} ({{ drink.quantity }} remaining)</li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        <!-- Add Drink Form -->
        <div class="card shadow-sm rounded p-4">
            <h3 class="text-center mb-4">Add a New Drink</h3>
            <form method="POST">
                {{ form.hidden_tag() }}
                
                <div class="mb-3">
                    {{ form.name.label(class="form-label") }}
                    {{ form.name(class="form-control rounded-pill input-custom") }}
                </div>
                
                <div class="mb-3">
                    {{ form.price.label(class="form-label") }}
                    {{ form.price(class="form-control rounded-pill input-custom") }}
                </div>
                
                <div class="mb-3">
                    {{ form.quantity.label(class="form-label") }}
                    {{ form.quantity(class="form-control rounded-pill input-custom") }}
                </div>
                
                <div class="mb-3">
                    {{ form.cost_price.label(class="form-label") }}
                    {{ form.cost_price(class="form-control rounded-pill input-custom") }}
                </div>
        
                <div class="d-grid">
                    {{ form.submit(class="btn btn-primary rounded-pill") }}
                </div>
            </form>
        </div>
        
        <!-- Inventory Table with Edit & Delete Options -->
        <div class="mt-5">
            <h2 class="inventory-heading">Available Inventory</h2>
            <table class="table table-hover table-striped table-bordered rounded shadow-sm">
                <thead class="table-dark">
                    <tr>
                        <th class="text-center">ID</th>
                        <th>Name</th>
                        <th>Selling Price (₵)</th>
                        <th>Cost Price (₵)</th>
                        <th>Quantity</th>
                        <th class="text-center">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for drink in drinks %}
                    <tr>
                        <td class="text-center">{{ drink.id }}</td>
                        <td>{{ drink.name }}</td>
                        <td>₵{{ drink.price }}</td>
                        <td>₵{{ drink.cost_price }}</td>
                        <td>{{ drink.quantity }}</td>
                        <td class="text-center">
                            <a href="{{ url_for('main.edit_drink', drink_id=drink.id) }}" class="btn btn-warning btn-sm">
                                <i class="fas fa-edit"></i> Edit
                            </a>
                            <form method="POST" action="{{ url_for('main.delete_drink', drink_id=drink.id) }}" style="display: inline;">
                                <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this drink?')">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
    </div>
</body>
</html>
